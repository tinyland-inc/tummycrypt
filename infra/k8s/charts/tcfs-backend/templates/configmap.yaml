apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "tcfs-backend.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "tcfs-backend.labels" . | nindent 4 }}
data:
  config.toml: |
    [daemon]
    socket       = "/run/tcfsd/tcfsd.sock"
    log_level    = {{ .Values.config.logLevel | quote }}
    log_format   = {{ .Values.config.logFormat | quote }}
    metrics_addr = "0.0.0.0:{{ .Values.metrics.port }}"

    [storage]
    endpoint = {{ .Values.config.s3Endpoint | quote }}
    region   = {{ .Values.config.s3Region | quote }}
    bucket   = {{ .Values.config.s3Bucket | quote }}

    [sync]
    nats_url    = {{ .Values.config.natsUrl | quote }}
    state_db    = "/var/lib/tcfsd/state.db"
    workers     = {{ .Values.config.workerConcurrency }}
    max_retries = 3

    [fuse]
    negative_cache_ttl_secs = 30
    cache_dir               = "/tmp/tcfs-cache"
    cache_max_mb            = 1024

    [secrets]
